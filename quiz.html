<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éƒ½é“åºœçœŒã‚¯ã‚¤ã‚º</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f0f0f0;
      margin: 0;
      padding: 10px;
    }
    h1 {
      font-size: 1.8em;
      margin-top: 10px;
    }
    #question {
      font-size: 2em;
      margin: 15px;
      font-weight: bold;
      color: #333;
    }
    #countdownOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      color: white;
      font-size: 10vw;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      display: none;
    }
    #timer, #result, #score {
      font-size: 1.2em;
      margin-top: 10px;
      font-weight: bold;
    }
    input, button {
      font-size: 1em;
      margin: 8px;
      padding: 10px;
      width: 80%;
      max-width: 300px;
    }
    img {
      max-width: 90%;
      height: auto;
      margin-top: 20px;
    }
    @media (min-width: 600px) {
      #question {
        font-size: 2.5em;
      }
      #countdownOverlay {
        font-size: 8vw;
      }
    }
  </style>
</head>
<body>
  <h1>éƒ½é“åºœçœŒã‚¯ã‚¤ã‚ºï¼ˆ10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‰</h1>
  <p id="question">ã€Œæ¬¡ã®å•é¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
  <p id="timer">ã‚¿ã‚¤ãƒãƒ¼ï¼š--</p>
  <p id="score">ã‚¹ã‚³ã‚¢ï¼š0 / 0å•ä¸­</p>
  <button id="nextBtn">æ¬¡ã®å•é¡Œ</button><br />
  <input type="text" id="answerInput" placeholder="éƒ½é“åºœçœŒåã‚’å…¥åŠ›" autocomplete="off" />
  <button id="answerBtn">ç­”ãˆã‚‹</button>
  <p id="result"></p>
  <img src="map.png" alt="æ—¥æœ¬åœ°å›³" />

  <div id="countdownOverlay"></div>

  <script>
    const prefectures = [
      "åŒ—æµ·é“", "é’æ£®çœŒ", "å²©æ‰‹çœŒ", "ç§‹ç”°çœŒ", "å®®åŸçœŒ", "å±±å½¢çœŒ", "ç¦å³¶çœŒ",
      "æ–°æ½ŸçœŒ", "èŒ¨åŸçœŒ", "æ ƒæœ¨çœŒ", "ç¾¤é¦¬çœŒ", "åŸ¼ç‰çœŒ", "åƒè‘‰çœŒ", "æ±äº¬éƒ½", "ç¥å¥ˆå·çœŒ",
      "å±±æ¢¨çœŒ", "é•·é‡çœŒ", "é™å²¡çœŒ", "å¯Œå±±çœŒ", "å²é˜œçœŒ", "æ„›çŸ¥çœŒ", "çŸ³å·çœŒ", "ç¦äº•çœŒ",
      "æ»‹è³€çœŒ", "ä¸‰é‡çœŒ", "äº¬éƒ½åºœ", "å¤§é˜ªåºœ", "å¥ˆè‰¯çœŒ", "å’Œæ­Œå±±çœŒ", "å…µåº«çœŒ",
      "é³¥å–çœŒ", "å²¡å±±çœŒ", "å³¶æ ¹çœŒ", "åºƒå³¶çœŒ", "å±±å£çœŒ",
      "é¦™å·çœŒ", "å¾³å³¶çœŒ", "é«˜çŸ¥çœŒ", "æ„›åª›çœŒ", "ç¦å²¡çœŒ", "å¤§åˆ†çœŒ", "ä½è³€çœŒ", "é•·å´çœŒ",
      "ç†Šæœ¬çœŒ", "å®®å´çœŒ", "é¹¿å…å³¶çœŒ", "æ²–ç¸„çœŒ"
    ];

    let currentNumber = null;
    let answerTimer = null;
    let timeLeft = 10;
    let answered = false;
    let score = 0;
    let questionCount = 0;
    const totalQuestions = 10;

    const questionEl = document.getElementById("question");
    const timerEl = document.getElementById("timer");
    const resultEl = document.getElementById("result");
    const answerInput = document.getElementById("answerInput");
    const nextBtn = document.getElementById("nextBtn");
    const answerBtn = document.getElementById("answerBtn");
    const scoreEl = document.getElementById("score");
    const countdownOverlay = document.getElementById("countdownOverlay");

    function normalizeAnswer(str) {
      return str
        .replace(/\s+/g, "")
        .replace(/ã€€+/g, "")
        .replace(/[éƒ½é“åºœçœŒ]+$/, "")
        .trim();
    }

    function startCountdown() {
      if (questionCount >= totalQuestions) {
        resultEl.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å†æŒ‘æˆ¦ã—ã¦ã­ã€‚";
        return;
      }

      answered = false;
      resultEl.textContent = "";
      answerInput.value = "";
      answerInput.disabled = true;
      countdownOverlay.style.display = "flex";

      let count = 3;
      countdownOverlay.textContent = count;

      const countdownTimer = setInterval(() => {
        count--;
        if (count > 0) {
          countdownOverlay.textContent = count;
        } else {
          clearInterval(countdownTimer);
          countdownOverlay.style.display = "none";
          generateQuestion();
        }
      }, 1000);
    }

    function generateQuestion() {
      currentNumber = Math.floor(Math.random() * 47) + 1;
      questionEl.textContent = `å•é¡Œ ${questionCount + 1}: ${currentNumber}ç•ªã®éƒ½é“åºœçœŒã¯ã©ã“ï¼Ÿ`;
      timeLeft = 10;
      timerEl.textContent = `ã‚¿ã‚¤ãƒãƒ¼ï¼š${timeLeft}ç§’`;
      answerInput.disabled = false;
      answerInput.focus();

      answerTimer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `ã‚¿ã‚¤ãƒãƒ¼ï¼š${timeLeft}ç§’`;
        if (timeLeft <= 0) {
          clearInterval(answerTimer);
          if (!answered) showTimeoutResult();
        }
      }, 1000);
    }

    function checkAnswer() {
      if (answered || timeLeft <= 0) return;

      const userAnswer = normalizeAnswer(answerInput.value);
      const correct = prefectures[currentNumber - 1];
      const correctNormalized = normalizeAnswer(correct);

      answered = true;
      clearInterval(answerTimer);
      questionCount++;

      if (userAnswer === correctNormalized) {
        const point = 1 + timeLeft;
        score += point;
        resultEl.textContent = `æ­£è§£ï¼ğŸ‰ +${point}ç‚¹`;
      } else {
        resultEl.textContent = `ä¸æ­£è§£ã€‚æ­£è§£ã¯ã€Œ${correct}ã€ã§ã™ã€‚`;
      }

      scoreEl.textContent = `ã‚¹ã‚³ã‚¢ï¼š${score} / ${questionCount}å•ä¸­`;

      if (questionCount >= totalQuestions) {
        questionEl.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼";
        nextBtn.disabled = true;
        answerInput.disabled = true;
        answerBtn.disabled = true;
      }
    }

    function showTimeoutResult() {
      answered = true;
      questionCount++;
      const correct = prefectures[currentNumber - 1];
      resultEl.textContent = `â±æ™‚é–“åˆ‡ã‚Œï¼æ­£è§£ã¯ã€Œ${correct}ã€ã§ã—ãŸã€‚`;
      scoreEl.textContent = `ã‚¹ã‚³ã‚¢ï¼š${score} / ${questionCount}å•ä¸­`;

      if (questionCount >= totalQuestions) {
        questionEl.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼";
        nextBtn.disabled = true;
        answerInput.disabled = true;
        answerBtn.disabled = true;
      }
    }

    answerInput.addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        checkAnswer();
      }
    });

    nextBtn.addEventListener("click", startCountdown);
    answerBtn.addEventListener("click", checkAnswer);
  </script>
</body>
</html>

